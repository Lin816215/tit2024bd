<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>公文查询</title>
		<link rel="stylesheet" href="../lib/layui-v2.6.3/css/layui.css" media="all">
		<link rel="stylesheet" href="../css/layuimini.css" media="all">
	</head>
	<body>
		<div>
			<div>
				<!-- 查询条件开始 -->
				<fieldset class="table-search-fieldset">
					<legend>搜索信息</legend>
					<div style="margin: 10px 10px 10px 10px">
						<form class="layui-form layui-form-pane" action="">
							<div class="layui-form-item">
								<div class="layui-inline">
									<label class="layui-form-label">公文编号</label>
									<div class="layui-input-inline">
										<input type="text" name="number" placeholder="请输入公文编号" autocomplete="off" class="layui-input">
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">公文标题</label>
									<div class="layui-input-inline">
										<input type="text" name="title" placeholder="请输入公文标题" autocomplete="off" class="layui-input">
									</div>
								</div>
								<div class="layui-inline">
									<label class="layui-form-label">发文日期</label>
									<div class="layui-input-inline">
										<input id="time" type="text" name="time" placeholder="请选择发文日期" autocomplete="off" class="layui-input">
									</div>
								</div>
								<div class="layui-inline">
									<button type="submit" class="layui-btn layui-btn-primary"  lay-submit lay-filter="data-search-btn"><i class="layui-icon"></i> 搜 索</button>
								</div>
							</div>
						</form>
					</div>
				</fieldset><!-- 查询条件结束 -->
				<!-- 工具栏设置： 添加用户、批量删除，这里id的值由程序员自定-->
				<script type="text/html" id="documentTableToolbar">
					<div class="layui-btn-container">
						<!-- 这里的lay-event="add"和delete在后面的JS代码中要用 -->
						<button class="layui-btn layui-btn-normal layui-btn-sm data-add-btn" lay-event="add"> 添加公文 </button>
						<button class="layui-btn layui-btn-sm layui-btn-danger data-delete-btn" lay-event="delete"> 批量删除 </button>
					</div>
				</script> <!--工具栏设置结束-->
				<table class="layui-hide" id="documentTable" lay-filter="documentTableFilter"></table>
				
						<!--用户状态列（看表格预览效果），id="userStatus"是程序员自定，后面JS中用-->
						<script type="text/html" id="documentStatus">
							<input type="checkbox" name="status"  checked lay-skin="switch" lay-text="已处理|未处理" lay-event="open" lay-filter="modifystatus" {{ d.status == '1'? 'checked' : '' }}/>
						</script>
				
				        <!-- 定义表格最后一列：操作 ；lay-event="detail"、 lay-event="edit"、lay-event="delete"后面JS会用到-->
						<script type="text/html" id="documentTableOperation">
							<a class="layui-btn layui-btn-normal layui-btn-xs data-count-edit" lay-event="detail">查看详情</a>
							<a class="layui-btn  layui-btn-xs data-count-edit" lay-event="edit">修改</a>
							<a class="layui-btn layui-btn-xs layui-btn-danger data-count-delete" lay-event="delete">删除</a>
						</script>
					</div>
				</div>
				<script src="../lib/layui-v2.6.3/layui.js" charset="utf-8"></script>
				<script>
					// 使用Layui的表单和表格模块
					layui.use(['form', 'table'], function () {
						var $ = layui.jquery;     // 获得jQuery
							form = layui.form;    // 获得表单模块
							table = layui.table;  // 获得表格模块
							
				        //渲染表格，也就是设置表格
				        table.render({
				        	elem: '#documentTable', // 上面表格的id
				        	url: 'd_content.json', // 表格数据JSON文件的位置
				        	toolbar: '#documentTableToolbar', // 工具栏的id，上面定义的 ；不写的话工具栏不会出现
				        	defaultToolbar: ['filter', 'exports', 'print', {
				        		title: '提示',
				        		layEvent: 'LAYTABLE_TIPS',
				        		icon: 'layui-icon-tips'
				        	}],
				        	cols: [[ // 列定义
				        		{type: "checkbox", width: 50},
				        		{field: 'number', width: 250, title: '公文编号'},
				        		{field: 'title', width: 400, title: '公文标题'},
				        		{field: 'unit', width:250, title: '发文单位'},
				        		{field: 'time', title: '发文日期', width: 150},
				        		{
				        			field : 'status',
				        			width:200,
				        			title : '状态',
				        			templet : '#documentStatus', // 上面用户状态列定义的id：documentStatus
				        			unresize : true,
				        			align: "center"
				        		},
				        		{title: '操作', minWidth: 130, toolbar: '#documentTableOperation', align: "center"}
				        	]],
				        	limits: [10, 15, 20, 25, 50, 100], // 每页显示条数切换
				        	limit: 15, // 每页默认显示15条数据
				        	page: true, // 不写的话，分页显示不会显示
				        	skin: 'line' // 表格有边框
				        });
				        
						// 监听搜索操作
						form.on('submit(data-search-btn)', function (data) {
							var result = JSON.stringify(data.field);
							layer.alert(result, {
								title: '最终的搜索信息'
							});
						
							//执行搜索重载
							table.reload('documentTable', {
								page: {
									curr: 1
								}
								, where: {
									searchParams: result
								}
							}, 'data');
						
							return false;
						});
				
						form.on('switch(modifystatus)', function(obj){
							console.log(obj);
							var param = obj.value;
						});
						
						/**
						 * toolbar监听事件（工具栏监听事件），就是：添加用户和批量删除
						 */
						table.on('toolbar(documentTableFilter)', function (obj) {
						    if (obj.event === 'add') {  // 监听添加操作，工具栏上的添加用户， lay-event="add"
								var index = layer.open({
									title: '添加公文',
									type: 2,
									shade: 0.2,
									maxmin:true,
									shadeClose: true,
									area: ['100%', '100%'],
									content: 'd_add.html',
								});
								$(window).on("resize", function () {
									layer.full(index);
								});
							} else if (obj.event === 'delete') {  // 监听批量删除操作
								var checkStatus = table.checkStatus('documentTable')
										, data = checkStatus.data;
								layer.alert(JSON.stringify(data));
							}
						});
						
						//监听表格复选框选择
						table.on('checkbox(documentTableFilter)', function (obj) {
							console.log(obj); // 这里是简单的将信息输出，可看浏览器控制台
						});
				         
						// 监听表格最后一列的操作：也就是最后一列的3个按钮：查看详情、修改和删除
							table.on('tool(documentTableFilter)', function (obj) {
								var data = obj.data;
								if(obj.event === 'detail'){
									//layer.alert("查看详情");
									var index = layer.open({
										title: '查看详情',
										type: 2,
										shade: 0.2,
										maxmin:true,
										shadeClose: true,
										area: ['100%', '100%'],
										content: 'd_add_c.html',
									});
									$(window).on("resize", function () {
										layer.full(index);
									});
									return false;
								} else if (obj.event === 'edit') {
									var index = layer.open({
										title: '编辑公文',
										type: 2,
										shade: 0.2,
										maxmin:true,
										shadeClose: true,
										area: ['100%', '100%'],
										content: 'd_add_e.html',
									});
									$(window).on("resize", function () {
										layer.full(index);
									});
									return false;
								} else if (obj.event === 'delete') {
									layer.confirm('您确认删除吗？', {icon:3}, function (index) {
										obj.del();
										layer.close(index);
									});
								}
							});
						
						});
				
					// 年选择器（选择入学年份），会用即可，具体实现此时不予关注
					layui.use('laydate', function(){
						var laydate = layui.laydate;
						var initYear;
						laydate.render({
						  elem: '#time'
						});
					});
			</script>
	</body>
</html>